@page
@inject IHtmlLocalizer<HomeSystemResource> L
@inject IPageLayout PageLayout
@model ProductKeysBookModel
@{
    PageLayout.Content.Title = L[HomeSystemResource.Menu.ProductKeysBook].Value;
}
<abp-card>
    <abp-card-header>@L[HomeSystemResource.Menu.ProductKeysBook]</abp-card-header>
    <abp-card-body>
        <abp-table id="dt-list" striped-rows="true" border-style="Bordered" />
    </abp-card-body>
</abp-card>
@section styles {
    <abp-script-bundle name="@HomeSystemBundles.Styles.jqDT_BS4" />
}
@section scripts {
    <abp-script-bundle name="@HomeSystemBundles.Scripts.DataGrid" />

    <script>
        $(function () {
            const endpoint = "/api/productkeysbook";
            const trueFalseOptions = ["false", "true"];
            const trueFalseOptionsText = ["私人", "公開"]
            $('#dt-list').DataTableEdit({
                ajax: {
                    url: endpoint + '/list',
                    contentType: "application/json",
                    type: "POST",
                    data: function (d) {
                        return JSON.stringify(d);
                    }
                },
                buttons: [
                    {
                        extend: 'selected',
                        text: '<i class="fa fa-trash mr-1"></i> @L[HomeSystemResource.Buttons.Delete]',
                        name: 'delete',
                        className: 'btn-danger btn-sm mr-1'
                    },
                    {
                        extend: 'selected',
                        text: '<i class="fa fa-edit mr-1"></i> @L[HomeSystemResource.Buttons.Edit]',
                        name: 'edit',
                        className: 'btn-warning btn-sm mr-1'
                    },
                    {
                        text: '<i class="fa fa-plus mr-1"></i> @L[HomeSystemResource.Buttons.Add]',
                        name: 'add',
                        className: 'btn-info btn-sm mr-1'
                    }
                ],
                columns: [
                    {
                        title: "Id", data: "id", type: "hidden", visible: false
                    },
                    { title: "@L[HomeSystemResource.Features.ProductKeysBook.DTFX.Columns.ProductName]", data: "productname", type: "text" },
                    {
                        title: "@L[HomeSystemResource.Features.ProductKeysBook.DTFX.Columns.ProductKey]", data: "productkey", type: "text",
                    },
                    {
                        title: "@L[HomeSystemResource.Features.ProductKeysBook.DTFX.Columns.Flag_Shared]",
                        data: "shared",
                        options: trueFalseOptions,
                        optionstext: trueFalseOptionsText,
                        type: "select",
                        render: function (data, type) {
                            console.log(type);

                            return `${data ? "公開" : "私人"}`;
                        }
                    },
                    {
                        title: "CreatorId", data: "creatorId", type: "hidden", visible: false
                    },
                    {
                        title: "Creation Time", data: "creationTime", type: "hidden", visible: false
                    },
                ],
                onAddRow: function (table, rowdata, success, error) {
                    $.ajax({
                        url: endpoint,
                        contentType: "multipart/form-data",
                        type: "POST",
                        data: table.formData,
                        processData: false,
                        contentType: false,
                        success: success,
                        error: error
                    });
                },
                onDeleteRow: function (table, rowdata, success, error) {
                    $.ajax({ url: endpoint, type: 'DELETE', data: rowdata, success: success, error: error });
                },
                onEditRow: function (table, rowdata, success, error) {
                    $.ajax({
                        url: endpoint,
                        contentType: "multipart/form-data",
                        type: "PUT",
                        data: table.formData,
                        processData: false,
                        contentType: false,
                        success: success,
                        error: error
                    });
                }
            });
        });
    </script>
}