@page
@inject IHtmlLocalizer<HomeSystemResource> L
@inject IPageLayout PageLayout
@model PassworkBookModel
@{
    PageLayout.Content.Title = L[HomeSystemResource.Menu.PasswordBook].Value;
}
<abp-card>
    <abp-card-header>@L[HomeSystemResource.Menu.PasswordBook]</abp-card-header>
    <abp-card-body>
        <abp-table id="dt-list" striped-rows="true" border-style="Bordered"/>
    </abp-card-body>
</abp-card>
@section styles {
    <abp-script-bundle name="@HomeSystemBundles.Styles.jqDT_BS4"/>    
}
@section scripts {
    <abp-script-bundle name="@HomeSystemBundles.Scripts.DataGrid"/>

    <script>
        $(function () {
            const endpoint = "/api/passwordbook";
            $('#dt-list').DataTableEdit({
                ajax: {
                    url: endpoint + '/list',
                    contentType: "application/json",
                    type: "POST",
                    data: function (d) {
                        return JSON.stringify(d);
                    }
                },
                buttons: [
                    {
                        extend: 'selected',
                        text: '<i class="fa fa-trash mr-1"></i> @L[HomeSystemResource.Buttons.Delete]',
                        name: 'delete',
                        className: 'btn-danger btn-sm mr-1'
                    },
                    {
                        extend: 'selected',
                        text: '<i class="fa fa-edit mr-1"></i> @L[HomeSystemResource.Buttons.Edit]',
                        name: 'edit',
                        className: 'btn-warning btn-sm mr-1'
                    },
                    {
                        text: '<i class="fa fa-plus mr-1"></i> @L[HomeSystemResource.Buttons.Add]',
                        name: 'add',
                        className: 'btn-info btn-sm mr-1'
                    }
                ],
                columns: [
                    {
                        title: "Id", data: "id", type: "hidden", visible: false
                    },
                    {   title: "@L[HomeSystemResource.Features.PasswordBook.DTFX.Columns.SiteName]", data: "siteName", type: "text" },
                    {
                        title: "@L[HomeSystemResource.Features.PasswordBook.DTFX.Columns.SiteURL]", data: "siteURL", type: "text",
                    },
                    {
                        title: "@L[HomeSystemResource.Features.PasswordBook.DTFX.Columns.LoginAccount]", data: "loginAccount", type: "text",
                    },
                    {
                        title: "@L[HomeSystemResource.Features.PasswordBook.DTFX.Columns.Password]", data: "password", type: "text",
                    },
                    {
                        title: "@L[HomeSystemResource.Features.PasswordBook.DTFX.Columns.IsHistory]", data: "isHistory", type: "hidden", visible: false,
                    },
                    {
                        title: "CreatorId", data: "creatorId", type: "hidden", visible: false
                    },
                    {
                        title: "Creation Time", data: "creationTime", type: "hidden", visible: false
                    }
                ],
                onAddRow: function (table, rowdata, success, error) {
                    $.ajax({
                        url: endpoint,
                        contentType: "multipart/form-data",
                        type: "POST",
                        data: table.formData,
                        processData: false,
                        contentType: false,
                        success: success,
                        error: error
                    });
                },
                onDeleteRow: function (table, rowdata, success, error) {
                    $.ajax({ url: endpoint, type: 'DELETE', data: rowdata, success: success, error: error });
                },
                onEditRow: function (table, rowdata, success, error) {
                    $.ajax({
                        url: endpoint,
                        contentType: "multipart/form-data",
                        type: "PUT",
                        data: table.formData,
                        processData: false,
                        contentType: false,
                        success: success,
                        error: error
                    });
                }
            });
        });
    </script>
}